window.Noble=window.Noble||{},Noble.config={cache:!0,portraitPassages:{tag:"portrait",onStartup:!0},storyVar:"$nobleAvatars"},window.Noble=window.Noble||{},window.Noble.cache=function(){var i=this,t=[],a=document.location.href.split("/");a.pop(),a=a.join("/")+"/",i.push=function(e,n){e.match(/^http/)||(e=a+e);var o=new Image;t[e]&&n?n(e):(n&&(o.onload=n,o.onerror=n),t[e]=o),o.src=e},i.pushArray=function(e,n,o){for(var t=0,a=e.length,r=0;r<a;r++)i.push(e[r],function(e){n&&n(e),++t==a&&setTimeout(function(){o(e)},1)})}},window.Noble=window.Noble||{},window.Noble.components={accessories:{components:{u:["accessory_1.png","accessory_10.png","accessory_11.png","accessory_12.png","accessory_13.png","accessory_14.png","accessory_15.png","accessory_16.png","accessory_17.png","accessory_18.png","accessory_19.png","accessory_2.png","accessory_20.png","accessory_3.png","accessory_4.png","accessory_5.png","accessory_6.png","accessory_7.png","accessory_8.png","accessory_9.png"],f:["accessory_f21.png"],m:["accessory_m21.png"]},required:!1,dir:{u:"./cac/accessories/",f:"./cac/accessories/f/",m:"./cac/accessories/m/"}},base:{components:{u:[],f:["head_f1.png","head_f10.png","head_f11.png","head_f12.png","head_f13.png","head_f14.png","head_f15.png","head_f2.png","head_f3.png","head_f4.png","head_f5.png","head_f6.png","head_f7.png","head_f8.png","head_f9.png"],m:["head_m1.png","head_m10.png","head_m11.png","head_m12.png","head_m13.png","head_m14.png","head_m15.png","head_m2.png","head_m3.png","head_m4.png","head_m5.png","head_m6.png","head_m7.png","head_m8.png","head_m9.png"]},required:!0,dir:{u:"./cac/base/",f:"./cac/base/f/",m:"./cac/base/m/"}},beard:{components:{u:[],f:[],m:["beard_1.png","beard_2.png","beard_3.png","beard_4.png","beard_5.png"]},required:!1,dir:{u:"./cac/beard/",f:"./cac/beard/f/",m:"./cac/beard/m/"}},eyes:{components:{u:[],f:["eye_f1.png","eye_f2.png","eye_f3.png","eye_f4.png","eye_f5.png","eye_f6.png","eye_f7.png","eye_f8.png"],m:["eye_m1.png","eye_m2.png","eye_m3.png","eye_m4.png","eye_m5.png","eye_m6.png","eye_m7.png","eye_m8.png"]},required:!0,dir:{u:"./cac/eyes/",f:"./cac/eyes/f/",m:"./cac/eyes/m/"}},features:{components:{u:["scar_1.png","scar_2.png"],f:[],m:["mustache_1.png","sideburn_1.png"]},required:!1,dir:{u:"./cac/features/",f:"./cac/features/f/",m:"./cac/features/m/"}},glasses:{components:{u:["eyepatch_1.png","eyepatch_2.png","glasses_1.png","glasses_2.png","glasses_3.png","glasses_4.png"],f:[],m:[]},required:!1,dir:{u:"./cac/glasses/",f:"./cac/glasses/f/",m:"./cac/glasses/m/"}},hair:{components:{u:[],f:["hair_f1.png","hair_f10.png","hair_f11.png","hair_f12.png","hair_f13.png","hair_f14.png","hair_f15.png","hair_f16.png","hair_f17.png","hair_f18.png","hair_f19.png","hair_f2.png","hair_f20.png","hair_f21.png","hair_f22.png","hair_f23.png","hair_f24.png","hair_f25.png","hair_f26.png","hair_f3.png","hair_f4.png","hair_f5.png","hair_f6.png","hair_f7.png","hair_f8.png","hair_f9.png"],m:["hair_m1.png","hair_m10.png","hair_m11.png","hair_m12.png","hair_m13.png","hair_m14.png","hair_m15.png","hair_m16.png","hair_m17.png","hair_m18.png","hair_m19.png","hair_m2.png","hair_m20.png","hair_m21.png","hair_m22.png","hair_m23.png","hair_m24.png","hair_m25.png","hair_m26.png","hair_m3.png","hair_m4.png","hair_m5.png","hair_m6.png","hair_m7.png","hair_m8.png","hair_m9.png"]},required:!1,dir:{u:"./cac/hair/",f:"./cac/hair/f/",m:"./cac/hair/m/"}},mouths:{components:{u:[],f:["mouth_f1.png","mouth_f2.png","mouth_f3.png","mouth_f4.png","mouth_f5.png","mouth_f6.png","mouth_f7.png","mouth_f8.png"],m:["mouth_m1.png","mouth_m2.png","mouth_m3.png","mouth_m4.png","mouth_m5.png","mouth_m6.png","mouth_m7.png","mouth_m8.png"]},required:!0,dir:{u:"./cac/mouths/",f:"./cac/mouths/f/",m:"./cac/mouths/m/"}},neck:{components:{u:["necklace_1.png","necklace_2.png","necklace_3.png","necklace_4.png","necklace_5.png","necklace_6.png"],f:["boa_1.png","boa_2.png","boa_3.png","boa_4.png","necklace_f7.png","necklace_f8.png"],m:["necklace_m7.png","necklace_m8.png"]},required:!1,dir:{u:"./cac/neck/",f:"./cac/neck/f/",m:"./cac/neck/m/"}}},function(){function t(e,n,o,t,a){$(document).trigger({type:":set-slot",action:e,group:n,gender:o,component:t,previous:a})}function n(e,n){var o=Noble.components[e].components[n],t=Noble.components[e].dir[n];return o.map(function(e){return t+e})}function o(e){return n(e,"u")}function a(e){return n(e,"f")}function r(e){return n(e,"m")}function i(e){return Noble.components[e].required}function e(e,n){switch(n){case"f":return o(e).concat(a(e));case"m":return o(e).concat(r(e));default:return o(e)}}var s={female:{accessories:{has:!0,component:"",options:e("accessories","f")},base:{has:!0,component:"",options:e("base","f"),required:i("base")},beard:{has:!1,component:"",options:[]},eyes:{has:!0,component:"",options:e("eyes","f")},features:{has:!0,component:"",options:e("features","f")},glasses:{has:!0,component:"",options:e("glasses","f")},hair:{has:!0,component:"",options:e("hair","f")},mouths:{has:!0,component:"",options:e("mouths","f")},neck:{has:!0,component:"",options:e("neck","f")}},male:{accessories:{has:!0,component:"",options:e("accessories","m")},base:{has:!0,component:"",options:e("base","m")},beard:{has:!0,component:"",options:e("beard","m")},eyes:{has:!0,component:"",options:e("eyes","m")},features:{has:!0,component:"",options:e("features","m")},glasses:{has:!0,component:"",options:e("glasses","m")},hair:{has:!0,component:"",options:e("hair","m")},mouths:{has:!0,component:"",options:e("mouths","m")},neck:{has:!0,component:"",options:e("neck","m")}}};function c(e,n){return s[n][e].has}function p(e,n){var o=s[n][e].component;return t("unset",e,n,"",o),s[n][e].component="",o}function d(e,n,o){return!(!c(e,n)||!s[n][e].options.includes(o))&&(t("set",e,n,o,s[n][e].component),s[n][e].component=o)}function g(e,n){if(!c(e,n))return p(e,n);var o=clone(s[n][e].options);return i(e)||("hair"===e?o.push(""):o.concat(["","",""])),d(e,n,o.random())}window.Noble.slots={get:{female:a,male:r,unisex:o},female:s.female,male:s.male,check:{required:i,possible:c},set:d,unset:p,randomize:g,randomizeAll:function(e){var n,o=Object.keys(s[e]),t=o.length;for(n=0;n<t;n++)g(o[n],e)},convert:function(n){var o={};return Object.keys(n).forEach(function(e){o[e]=n[e].component}),o}}}(),function(){Noble.editor={gender:"female",madeChanges:{male:!1,female:!1}};var r=$(document.createElement("div")).addClass("editor-wrapper").append('<div id="editor-view"></div><div id="editor-window"><div id="editor-header"><select id="editor-window" tab-index="0"><option value="base">Skin</option><option value="eyes">Eyes</option><option value="mouths">Mouth</option><option value="hair">Hair</option><option value="beard">Beard</option><option value="features">Features</option><option value="glasses">Glasses</option><option value="neck">Neck</option><option value="accessories">Hat</option></select><button id="gender" tab-index="0">Change to Male</button></div><div id="editor-window-wrapper"><div class="editor-content selected" id="base"></div><div class="editor-content" id="eyes"></div><div class="editor-content" id="mouths"></div><div class="editor-content" id="hair"></div><div class="editor-content" id="beard"></div><div class="editor-content" id="features"></div><div class="editor-content" id="glasses"></div><div class="editor-content" id="neck"></div><div class="editor-content" id="accessories"></div></div></div>');function i(){var e=new Noble.Character("editorPt",Noble.slots.convert(Noble.slots[Noble.editor.gender])),n=new Noble.Portrait(e.id,e.def);return $("#editor-view").empty().append(n.$el),Noble.editor.character=e,Noble.editor.$pt=n}function e(){$("div.editor-content").toArray().forEach(function(e){var n=$(e),o=n.attr("id"),t=Noble.editor.gender,a=Noble.slots[t][o].options.map(function(e){return $(document.createElement("img")).addClass("editor-option").attr({src:e,"data-option":e}).ariaClick(function(){Noble.slots.set(o,t,$(this).attr("data-option")),Noble.editor.madeChanges[Noble.editor.gender]||(Noble.editor.madeChanges[Noble.editor.gender]=!0),i()})});if(!Noble.slots.check.required(o)){var r=$(document.createElement("img")).addClass("editor-option").attr({src:"./cac/none.png","data-option":""}).ariaClick(function(){Noble.slots.unset(o,t),Noble.editor.madeChanges[Noble.editor.gender]||(Noble.editor.madeChanges[Noble.editor.gender]=!0),i()});a.unshift(r)}n.empty().append(a)})}function s(){Noble.editor.madeChanges[Noble.editor.gender]||Noble.slots.randomizeAll(Noble.editor.gender),i(),e()}Noble.editor.start=function(e,n,o){var t,a;$(e).append(r),r.height(r.width()),s(),t=n,a=o,$(document.createElement("button")).attr("id","editor-button-confirm").wiki("Confirm").ariaClick(function(){$(document).trigger({type:":editor-confirm",id:t,passage:a})}).appendTo(r),$("div#editor-window button#gender").ariaClick(function(){$(this).empty().wiki("Change to "+Noble.editor.gender.toUpperFirst()),"female"===Noble.editor.gender?Noble.editor.gender="male":Noble.editor.gender="female",s()}),$("select#editor-window").on("change",function(){var e=$(this).val();$("div.editor-content.selected").removeClass("selected"),$("div.editor-content#"+e).addClass("selected")}),$("#editor-view .layer").on("dblclick",function(){try{var e=JSON.stringify(Noble.slots.convert(Noble.slots[Noble.editor.gender]));Dialog.setup("Character Data","editor-data-out"),Dialog.wiki("<textarea>"+e+"</textarea>"),Dialog.open()}catch(e){console.error(e)}}),$(document).on(":editor-confirm",function(e){Noble.Character.add(e.id,Noble.slots.convert(Noble.slots[Noble.editor.gender])),Engine.play(e.passage)})},Noble.editor.update=s,Noble.editor.content=e,Noble.editor.portrait=i,Noble.editor.$el=r}(),function(){var r=["base","eyes","mouths","features","glasses","hair","neck","beard","accessories"];Noble.Portrait=function(e,o,n){if(!(this instanceof Noble.Portrait))return new Noble.Portrait(e,o,n);var t=$(document.createElement("div")).addClass("noble-wrapper").attr("id",Util.slugify(e)),a=r.map(function(e){var n=o[e]?'url("'+o[e]+'")':"";return console.log(n,o[e],o),$(document.createElement("div")).addClass("layer").attr("data-group",e).css("background-image",n)});n&&t.ariaClick(function(){$.wiki(n)}),t.append(a),this.$el=t,this.wiki=n,this.id=e,this.$layers=a},Noble.Portrait.prototype={constructor:Noble.Porait,getLayerIdx:function(n){return this.$layers.findIndex(function(e){return e.attr("data-group")===n})},getLayer:function(n){return this.$layers.find(function(e){return e.attr("data-group")===n})},changeLayer:function(e,n){var o=this.getLayer(e);o[0]&&o.css("background-image",n)}}}(),State.setVar(Noble.config.storyVar,[]),Noble.Character=function(e,n){if(!(this instanceof Noble.Character))return new Noble.Character(e,n);this.id=e,this.def=clone(n)},Noble.Character.is=function(e){return e instanceof Noble.Character},Noble.Character.add=function(e,n){n.base.hasOwnProperty("has")&&(n=Noble.slots.convert(n));var o=new Noble.Character(e,n);return State.getVar(Noble.config.storyVar).push(o),o},Noble.Character.generateFromPassage=function(e){try{var n=JSON.parse(Story.get(e).text);Noble.Character.add(e,n)}catch(e){console.error("uh oh")}},Noble.Character.getByID=function(n){return State.getVar(Noble.config.storyVar).find(function(e){return e.id===n&&Noble.Character.is(e)})},Noble.Character.random=function(e,n){return e=e||either("male","female"),n=n||"rnd-"+Math.random().toString(36).substring(7),Noble.slots.randomizeAll(e),Noble.Character.add(n,Noble.slots[e])},Noble.Character.test=function(e){var n=Noble.Character.random(e),o=Noble.Portrait(n.id,n.def);$("#passages").append(o.$el)},Noble.Character.prototype={constructor:Noble.Character,toJSON:function(){JSON.reviveWrapper("new Noble.Character("+JSON.stringify(this.id)+", "+JSON.stringify(this.def)+")")},clone:function(){return new Noble.Character(this.id,this.def)},portrait:function(){return Noble.Portrait(this.id,this.def)},clickablePt:function(e){return Noble.Portrait(this.id,this.def,e)}};