window.Noble=window.Noble||{},
Noble.config = {
    cache: true,
    portraitPassages: { tag: "avatar", onStartup: true },
    storyVar: "$nobleAvatars",
    defaultStrings: {
        swapGender: {
            both: "",
            female: "Change to Male",
            male: "Change to Female"
        },
        confirmBtn: "Confirm",
        groupNames: {
            base: "Skin",
            eyes: "Eyes",
            mouths: "Mouth",
            hair: "Hair",
            beard: "Beard",
            features: "Features",
            glasses: "Glasses",
            neck: "Neck",
            accessories: "Hat"
        }
    }
},
function(){function n(e,t,n){var o=e||null,a=[];if(o){var r,i=o.length;for(r=0;r<i;r++){var s=new Image;s.onload=function(){var e=a.indexOf(this);-1!==e&&a.deleteAt(e)},a.push(s),s.src=o[r]}}}function o(t){if(console.log(t),t=t||Noble.components||null)return Object.keys(t).map(function(e){return function(t){console.log(t);var e=t.components.u.map(function(e){return t.dir.u+e}),n=t.components.f.map(function(e){return t.dir.f+e}),o=t.components.m.map(function(e){return t.dir.m+e});return e.concat(n,o)}(t[e])}).flatten()}window.Noble=window.Noble||{},window.Noble.cache={cacheAll:function(e,t){e=e||o(Noble.components)||null,console.log(e),e&&n(e),t&&"function"==typeof t&&t()},fetchUrls:o,cacher:n}}(),window.Noble=window.Noble||{},window.Noble.components={accessories:{components:{u:["accessory_1.png","accessory_10.png","accessory_11.png","accessory_12.png","accessory_13.png","accessory_14.png","accessory_15.png","accessory_16.png","accessory_17.png","accessory_18.png","accessory_19.png","accessory_2.png","accessory_20.png","accessory_3.png","accessory_4.png","accessory_5.png","accessory_6.png","accessory_7.png","accessory_8.png","accessory_9.png"],f:["accessory_f21.png"],m:["accessory_m21.png"]},required:!1,dir:{u:"./cac/accessories/",f:"./cac/accessories/f/",m:"./cac/accessories/m/"}},base:{components:{u:[],f:["head_f1.png","head_f10.png","head_f11.png","head_f12.png","head_f13.png","head_f14.png","head_f15.png","head_f2.png","head_f3.png","head_f4.png","head_f5.png","head_f6.png","head_f7.png","head_f8.png","head_f9.png"],m:["head_m1.png","head_m10.png","head_m11.png","head_m12.png","head_m13.png","head_m14.png","head_m15.png","head_m2.png","head_m3.png","head_m4.png","head_m5.png","head_m6.png","head_m7.png","head_m8.png","head_m9.png"]},required:!0,dir:{u:"./cac/base/",f:"./cac/base/f/",m:"./cac/base/m/"}},beard:{components:{u:[],f:[],m:["beard_1.png","beard_2.png","beard_3.png","beard_4.png","beard_5.png"]},required:!1,dir:{u:"./cac/beard/",f:"./cac/beard/f/",m:"./cac/beard/m/"}},eyes:{components:{u:[],f:["eye_f1.png","eye_f2.png","eye_f3.png","eye_f4.png","eye_f5.png","eye_f6.png","eye_f7.png","eye_f8.png"],m:["eye_m1.png","eye_m2.png","eye_m3.png","eye_m4.png","eye_m5.png","eye_m6.png","eye_m7.png","eye_m8.png"]},required:!0,dir:{u:"./cac/eyes/",f:"./cac/eyes/f/",m:"./cac/eyes/m/"}},features:{components:{u:["scar_1.png","scar_2.png"],f:[],m:["mustache_1.png","sideburn_1.png"]},required:!1,dir:{u:"./cac/features/",f:"./cac/features/f/",m:"./cac/features/m/"}},glasses:{components:{u:["eyepatch_1.png","eyepatch_2.png","glasses_1.png","glasses_2.png","glasses_3.png","glasses_4.png"],f:[],m:[]},required:!1,dir:{u:"./cac/glasses/",f:"./cac/glasses/f/",m:"./cac/glasses/m/"}},hair:{components:{u:[],f:["hair_f1.png","hair_f10.png","hair_f11.png","hair_f12.png","hair_f13.png","hair_f14.png","hair_f15.png","hair_f16.png","hair_f17.png","hair_f18.png","hair_f19.png","hair_f2.png","hair_f20.png","hair_f21.png","hair_f22.png","hair_f23.png","hair_f24.png","hair_f25.png","hair_f26.png","hair_f3.png","hair_f4.png","hair_f5.png","hair_f6.png","hair_f7.png","hair_f8.png","hair_f9.png"],m:["hair_m1.png","hair_m10.png","hair_m11.png","hair_m12.png","hair_m13.png","hair_m14.png","hair_m15.png","hair_m16.png","hair_m17.png","hair_m18.png","hair_m19.png","hair_m2.png","hair_m20.png","hair_m21.png","hair_m22.png","hair_m23.png","hair_m24.png","hair_m25.png","hair_m26.png","hair_m3.png","hair_m4.png","hair_m5.png","hair_m6.png","hair_m7.png","hair_m8.png","hair_m9.png"]},required:!1,dir:{u:"./cac/hair/",f:"./cac/hair/f/",m:"./cac/hair/m/"}},mouths:{components:{u:[],f:["mouth_f1.png","mouth_f2.png","mouth_f3.png","mouth_f4.png","mouth_f5.png","mouth_f6.png","mouth_f7.png","mouth_f8.png"],m:["mouth_m1.png","mouth_m2.png","mouth_m3.png","mouth_m4.png","mouth_m5.png","mouth_m6.png","mouth_m7.png","mouth_m8.png"]},required:!0,dir:{u:"./cac/mouths/",f:"./cac/mouths/f/",m:"./cac/mouths/m/"}},neck:{components:{u:["necklace_1.png","necklace_2.png","necklace_3.png","necklace_4.png","necklace_5.png","necklace_6.png"],f:["boa_1.png","boa_2.png","boa_3.png","boa_4.png","necklace_f7.png","necklace_f8.png"],m:["necklace_m7.png","necklace_m8.png"]},required:!1,dir:{u:"./cac/neck/",f:"./cac/neck/f/",m:"./cac/neck/m/"}}},Noble.config&&Noble.config.cache&&Noble.cache.cacheAll(),function(){function o(e,t,n,o,a){$(document).trigger({type:":set-slot",action:e,group:t,gender:n,component:o,previous:a})}function t(e,t){var n=Noble.components[e].components[t],o=Noble.components[e].dir[t];return n.map(function(e){return o+e})}function n(e){return t(e,"u")}function a(e){return t(e,"f")}function r(e){return t(e,"m")}function i(e){return Noble.components[e].required}function e(e,t){switch(t){case"f":return n(e).concat(a(e));case"m":return n(e).concat(r(e));default:return n(e)}}var s={female:{accessories:{has:!0,component:"",options:e("accessories","f")},base:{has:!0,component:"",options:e("base","f"),required:i("base")},beard:{has:!1,component:"",options:[]},eyes:{has:!0,component:"",options:e("eyes","f")},features:{has:!0,component:"",options:e("features","f")},glasses:{has:!0,component:"",options:e("glasses","f")},hair:{has:!0,component:"",options:e("hair","f")},mouths:{has:!0,component:"",options:e("mouths","f")},neck:{has:!0,component:"",options:e("neck","f")}},male:{accessories:{has:!0,component:"",options:e("accessories","m")},base:{has:!0,component:"",options:e("base","m")},beard:{has:!0,component:"",options:e("beard","m")},eyes:{has:!0,component:"",options:e("eyes","m")},features:{has:!0,component:"",options:e("features","m")},glasses:{has:!0,component:"",options:e("glasses","m")},hair:{has:!0,component:"",options:e("hair","m")},mouths:{has:!0,component:"",options:e("mouths","m")},neck:{has:!0,component:"",options:e("neck","m")}}};function c(e,t){return s[t][e].has}function d(e,t){var n=s[t][e].component;return o("unset",e,t,"",n),s[t][e].component="",n}function p(e,t,n){return!(!c(e,t)||!s[t][e].options.includes(n))&&(o("set",e,t,n,s[t][e].component),s[t][e].component=n)}function l(e,t){if(!c(e,t))return d(e,t);var n=clone(s[t][e].options);return i(e)||("hair"===e?n.push(""):n.concat(["","",""])),p(e,t,n.random())}window.Noble.slots={get:{female:a,male:r,unisex:n},female:s.female,male:s.male,check:{required:i,possible:c},set:p,unset:d,randomize:l,randomizeAll:function(e){var t,n=Object.keys(s[e]),o=n.length;for(t=0;t<o;t++)l(n[t],e)},convert:function(t){var n={};return Object.keys(t).forEach(function(e){n[e]=t[e].component}),n}}}(),function(){function t(e){return Noble.config.defaultStrings.swapGender.both?Noble.config.defaultStrings.swapGender.both:Noble.config.defaultStrings.swapGender[e]}function e(e){return Noble.config.defaultStrings.groupNames[e]}Noble.editor={gender:"female",madeChanges:{male:!1,female:!1}};var n='<div id="editor-view"></div><div id="editor-window"><div id="editor-header"><select id="editor-window" tab-index="0"><option value="base">'+e("base")+'</option><option value="eyes">'+e("eyes")+'</option><option value="mouths">'+e("mouths")+'</option><option value="hair">'+e("hair")+'</option><option value="beard">'+e("beard")+'</option><option value="features">'+e("features")+'</option><option value="glasses">'+e("glasses")+'</option><option value="neck">'+e("neck")+'</option><option value="accessories">'+e("accessories")+'</option></select><button id="gender" tab-index="0">'+t("female")+'</button></div><div id="editor-window-wrapper"><div class="editor-content selected" id="base"></div><div class="editor-content" id="eyes"></div><div class="editor-content" id="mouths"></div><div class="editor-content" id="hair"></div><div class="editor-content" id="beard"></div><div class="editor-content" id="features"></div><div class="editor-content" id="glasses"></div><div class="editor-content" id="neck"></div><div class="editor-content" id="accessories"></div></div></div>';function r(){return $(document.createElement("div")).addClass("editor-wrapper").append(n)}function i(e,t,n){$(document.createElement("button")).attr("id","editor-button-confirm").wiki(Noble.config.defaultStrings.confirmBtn).ariaClick(function(){$(document).trigger({type:":editor-confirm",id:t,passage:n}),$(this).remove()}).appendTo(e)}function s(){var e=new Noble.Character("editorPt",Noble.slots.convert(Noble.slots[Noble.editor.gender])),t=new Noble.Portrait(e.id,e.def);return $("#editor-view").empty().append(t.$el),Noble.editor.character=e,Noble.editor.$pt=t}function o(){$("div.editor-content").toArray().forEach(function(e){var t=$(e),n=t.attr("id"),o=Noble.editor.gender,a=Noble.slots[o][n].options.map(function(e){return $(document.createElement("img")).addClass("editor-option").attr({src:e,"data-option":e}).ariaClick(function(){Noble.slots.set(n,o,$(this).attr("data-option")),Noble.editor.madeChanges[Noble.editor.gender]||(Noble.editor.madeChanges[Noble.editor.gender]=!0),s()})});if(!Noble.slots.check.required(n)){var r=$(document.createElement("img")).addClass("editor-option").attr({src:"./cac/none.png","data-option":""}).ariaClick(function(){Noble.slots.unset(n,o),Noble.editor.madeChanges[Noble.editor.gender]||(Noble.editor.madeChanges[Noble.editor.gender]=!0),s()});a.unshift(r)}t.empty().append(a)})}function c(){Noble.editor.madeChanges[Noble.editor.gender]||Noble.slots.randomizeAll(Noble.editor.gender),s(),o()}function d(e){$("div#editor-window button#gender").ariaClick(function(){$(this).empty().wiki(t(Noble.editor.gender)),"female"===Noble.editor.gender?Noble.editor.gender="male":Noble.editor.gender="female",c()}),$("select#editor-window").on("change",function(){var e=$(this).val();$("div.editor-content.selected").removeClass("selected"),$("div.editor-content#"+e).addClass("selected")}),e&&$("#editor-view .layer").ariaClick(function(){try{var e=JSON.stringify(Noble.slots.convert(Noble.slots[Noble.editor.gender]));Dialog.setup("Character Data","editor-data-out"),Dialog.wiki('<textarea id="data-out">'+e+"</textarea>\n\n<<button 'Select All'>><<run $('#data-out').select()>><</button>><<button 'Copy to Clipboard'>><<run $('#data-out').select()>><<run document.execCommand('copy')>><</button>>"),Dialog.open()}catch(e){console.error(e)}}),$(document).on(":editor-confirm",function(e){Noble.Character.add(e.id,Noble.slots.convert(Noble.slots[Noble.editor.gender])),Engine.play(e.passage)})}Noble.editor.start=function(e,t,n,o){var a=r();$(e).append(a),a.height(a.width()),postdisplay["editor-init"]=function(e){delete postdisplay[e],c(),i(a,t,n),d(o)}},Noble.editor.update=c,Noble.editor.content=o,Noble.editor.portrait=s,Noble.editor.build=r,Noble.editor.handlers=d}(),function(){var n=["base","eyes","mouths","features","glasses","hair","neck","beard","accessories"];Noble.Portrait=function(e,r,i){if(!(this instanceof Noble.Portrait))return new Noble.Portrait(e,r,i);var s=$(document.createElement("div")).addClass("noble-wrapper").attr("id",Util.slugify(e)),t=n.map(function(e,t,n){var o=r[e]?'url("'+r[e]+'")':"",a=$(document.createElement("div")).addClass("layer").attr("data-group",e).css("background-image",o);return i&&"string"==typeof i&&i.trim()&&t===n.length-1&&s.ariaClick(function(){$.wiki(i)}).css("cursor","pointer"),a});s.append(t),this.$el=s,this.wiki=i,this.id=e,this.$layers=t},Noble.Portrait.prototype={constructor:Noble.Porait,getLayerIdx:function(t){return this.$layers.findIndex(function(e){return e.attr("data-group")===t})},getLayer:function(t){return this.$layers.find(function(e){return e.attr("data-group")===t})},changeLayer:function(e,t){var n=this.getLayer(e);n[0]&&n.css("background-image",t)}}}(),function(){if(State.setVar(Noble.config.storyVar,[]),Noble.Character=function(e,t){if(!(this instanceof Noble.Character))return new Noble.Character(e,t);this.id=e,this.def=clone(t)},Noble.Character.is=function(e){return e instanceof Noble.Character},Noble.Character.add=function(e,t){t.base.hasOwnProperty("has")&&(t=Noble.slots.convert(t));var n=new Noble.Character(e,t);return State.getVar(Noble.config.storyVar).push(n),n},Noble.Character.generateFromPassage=function(e){try{var t=JSON.parse(Story.get(e).text);Noble.Character.add(e,t)}catch(e){console.error(e.message)}},Noble.Character.getByID=function(t){return State.getVar(Noble.config.storyVar).find(function(e){return e.id===t&&Noble.Character.is(e)})},Noble.Character.random=function(e,t){return e=e||either("male","female"),t=t||"rnd-"+Math.random().toString(36).substring(7),Noble.slots.randomizeAll(e),Noble.Character.add(t,Noble.slots[e])},Noble.Character.test=function(e){var t=Noble.Character.random(e),n=Noble.Portrait(t.id,t.def);$("#passages").append(n.$el)},Noble.Character.prototype={constructor:Noble.Character,toJSON:function(){JSON.reviveWrapper("new Noble.Character("+JSON.stringify(this.id)+", "+JSON.stringify(this.def)+")")},clone:function(){return new Noble.Character(this.id,this.def)},portrait:function(){return Noble.Portrait(this.id,this.def)},clickablePt:function(e){return Noble.Portrait(this.id,this.def,e)}},Noble.config.portraitPassages&&Noble.config.portraitPassages.onStartup){var e=Noble.config.portraitPassages.tag;Story.lookup("tags",e).forEach(function(e){Noble.Character.generateFromPassage(e.title)})}}(),Macro.add("pt",{handler:function(){if(this.args.length<1)return this.error("You must provide a character ID as the first argument to this macro.");var e=Noble.Character.getByID(this.args[0]);if((!e||!Noble.Character.is(e))&&Story.has(this.args[0]))try{Noble.Character.generateFromPassage(this.args[0])}catch(e){return this.error(e.message)}if(!e||!Noble.Character.is(e))return this.error('Could not find character with the ID: "'+this.args[0]+'".');var t=Noble.Portrait(e.id,e.def);if(t.$el.removeClass().addClass("noble-wrapper"),0<this.args.length){var n=this.args.slice(1).flatten();t.$el.addClass(n.join(" "))}$(this.output).append(t.$el)}}),Macro.add("ptlink",{tags:null,handler:function(){if(this.args.length<1)return this.error("You must provide a character ID as the first argument to this macro.");var e=Noble.Character.getByID(this.args[0]);if((!e||!Noble.Character.is(e))&&Story.has(this.args[0]))try{Noble.Character.generateFromPassage(this.args[0])}catch(e){return this.error(e.message)}if(!e||!Noble.Character.is(e))return this.error('Could not find character with the ID: "'+this.args[0]+'".');var t=Noble.Portrait(e.id,e.def,this.payload[0].contents);if(t.$el.removeClass().addClass("noble-wrapper"),0<this.args.length){var n=this.args.slice(1).flatten();t.$el.addClass(n.join(" "))}$(this.output).append(t.$el)}}),Macro.add("avatarmaker",{handler:function(){return this.args.length<2?this.error("You must pass two arguments to this macro: the ID of the character being created and the passage to go to when creation is complete."):Story.has(this.args[1])?void Noble.editor.start(this.output,this.args[0],this.args[1],this.args[2]):this.error('No passage name "'+this.args[1]+'" could be found.')}});